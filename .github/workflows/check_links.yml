name: Check Links & Anchors

on:
  pull_request:
    paths:
      - '**/*.md'
      - 'tools/check_links.py'
  schedule:
    - cron: '17 2 * * 2'  # Weekly deep check (UTC)
  workflow_dispatch: {}

permissions:
  contents: read

jobs:
  links:
    runs-on: ubuntu-latest
    steps:
      - name: ⬇️ Checkout
        uses: actions/checkout@v4
      - name: 🐍 Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - name: 📦 Install deps
        run: python -m pip install --upgrade pip
      - name: 🔗 Check internal + external
        run: |
          python tools/check_links.py --root .             --glob "intake/**/*.md" --glob "canonized/**/*.md" --glob "README.md" --glob "INDEX.md"             --ignore "**/attachments/**" --timeout 10 --workers 16 --format text --report linkcheck.txt
      - name: 📤 Upload report
        uses: actions/upload-artifact@v4
        with:
          name: linkcheck
          path: linkcheck.txt
