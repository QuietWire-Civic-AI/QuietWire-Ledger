import sys, runpy from pathlib import Path ENTRY = """--- title: "Indexable" author: "Tester" ledger_stream: "Demo" hashes: body_sha256: "will-be-set" --- # Body """ def test_build_index_generates_file(sandbox_repo, tmp_path): # Add a simple entry e = sandbox_repo / "canonized" / "demo.md" e.write_text(ENTRY, encoding="utf-8") script = sandbox_repo / "tools" / "build_index.py" out = sandbox_repo / "INDEX.md" argv = sys.argv sys.argv = ["build_index.py", "--root", str(sandbox_repo), "--out", str(out), "--include-intake", "--group-by", "stream"] try: runpy.run_path(str(script), run_name="__main__") finally: sys.argv = argv assert out.exists() txt = out.read_text(encoding="utf-8") assert "Indexable" in txt